#!/usr/bin/env ruby
require_relative 'mob_rotation'

file_name = ARGV[0] || 'rotate.txt'
command = ARGV[1]
mobster_names = ARGV[2..-1]
git_dir = ENV['MOB_GIT_DIR'] || File.join(Dir.pwd, ".git")

def command_router(command, mobster_names, file_name, git_dir)
  mob_rotator = MobRotation.new(MobRotation::Database.new(file_name), git_dir)
  case command
  when nil
    mob_rotator.show_mobsters
  when "rotate"
    mob_rotator.rotate
    mob_rotator.show_mobsters
  when "add"
    mob_rotator.add_mobster(*mobster_names)
    mob_rotator.show_mobsters
  when "remove"
    mob_rotator.remove_mobsters(*mobster_names)
    mob_rotator.show_mobsters
  when "help"
    mob_rotator.show_help
  when "run_with_timer"
    mob_rotator.run_timer(ARGV[2].to_i)
  when "run_with_timer_and_beep"
    mob_rotator.run_timer_and_beep
  else
    mob_rotator.inform_lovely_user(command)
  end
end

command_router(command, mobster_names, file_name, git_dir)
